# UV光谱预测COD框架

本框架支持多种机器学习和深度学习方法，用于根据UV-Vis光谱数据预测化学需氧量（COD）值。

## 项目概述
该框架实现了多种机器学习和深度学习方法，用于根据UV-Vis光谱数据预测化学需氧量（COD）值。当前已实现一维卷积神经网络（1D-CNN）方法，未来将支持LSTM、Transformer和随机森林等多种模型。该解决方案按要求特别忽略了pH值和浊度值，仅专注于200nm至375nm的光谱数据。

## 项目结构

```
test/
├── data/                    # 数据相关
│   └── UV_COD_Correct_Dataset.csv  # 原始数据集
├── models/                  # 模型相关（按类型分类）
│   ├── 1d_cnn/              # 1D卷积神经网络模型
│   ├── lstm/                # LSTM模型
│   ├── transformer/          # Transformer模型
│   └── random_forest/       # 随机森林模型
├── results/                 # 训练结果
├── test_results/            # 测试结果
├── main.py                  # 主脚本（包含训练和预测功能）
├── test_model.py            # 测试脚本（用于测试新数据）
└── README.md                # 项目说明
```

## 主要功能

### main.py
- **训练模式**：默认模式，用于训练模型
  - 加载和预处理数据
  - 构建和训练选定的模型（默认1D-CNN）
  - 使用5折交叉验证评估模型性能
  - 保存训练好的模型

- **预测模式**：通过添加 `predict` 参数启用
  - 加载训练好的模型
  - 对数据集中的样本进行预测
  - 显示预测结果

### test_model.py
- **模型测试**：用于在新数据集上测试训练好的模型
  - 加载测试数据集
  - 加载训练好的模型
  - 进行预测并评估性能
  - 生成预测结果和可视化图表

## 支持的模型方法

### 当前已实现
- **1D-CNN**：一维卷积神经网络，适用于序列数据处理

### 计划实现
- **LSTM**：长短期记忆网络，适用于时间序列数据
- **Transformer**：Transformer模型，适用于捕获长距离依赖关系
- **随机森林**：传统机器学习方法，适用于特征重要性分析

## 模型架构

### 1D-CNN模型（当前实现）
一维卷积神经网络模型包括：
1. 输入层接受176个光谱值序列（200nm至375nm）
2. 三个卷积块，包含：
   - 卷积核大小递增的Conv1D层（32、64、128个滤波器）
   - 批标准化
   - 最大池化层
   - 用于正则化的Dropout
3. 全局平均池化层
4. 带Dropout的密集层用于最终预测

### 计划实现的模型架构

#### LSTM模型
- 输入层接受176个光谱值序列
- 多层LSTM层捕获序列依赖关系
- 全连接层进行最终预测

#### Transformer模型
- 输入层接受176个光谱值序列
- 自注意力机制捕获长距离依赖关系
- 前馈网络进行最终预测

#### 随机森林模型
- 输入层接受176个光谱值特征
- 多棵决策树集成学习
- 平均预测结果作为最终输出

## 使用方法

### 训练模型
默认使用1D-CNN模型：
```bash
python main.py
```

### 预测模式
```bash
python main.py predict
```

### 测试模型
在新数据集上测试训练好的模型：
```bash
python test_model.py
```

## 模型选择

当前默认使用1D-CNN模型。未来版本将支持通过命令行参数选择不同的模型：

```bash
# 示例：使用LSTM模型
python main.py --model lstm

# 示例：使用Transformer模型
python main.py --model transformer

# 示例：使用随机森林模型
python main.py --model random_forest
```

## 性能指标

训练完成后，模型会显示以下性能指标：
- MSE（均方误差）
- MAE（平均绝对误差）
- RMSE（均方根误差）
- R²得分

### 训练结果

训练完成后，以下结果文件会保存在 `results/` 目录中：

**数据文件：**
- **training_results.json**：包含完整的训练指标和历史记录，便于后续分析
- **training_summary.txt**：包含简洁的训练摘要，易于阅读

**可视化图表：**
- **training_history.png**：显示训练和验证的损失及MAE曲线
- **predictions.png**：显示实际COD值与预测COD值的散点图
- **residuals.png**：显示预测残差图，评估模型预测的稳定性

这些文件记录了模型的性能指标、训练历史和可视化结果，方便您全面评估模型的训练效果。

## 注意事项

- 模型仅使用200nm至375nm的UV光谱数据进行预测
- 忽略了pH值和浊度值
- 模型保存位置：
  - 1D-CNN模型：`models/1d_cnn/cod_model.keras`
  - 其他模型（计划）：`models/{model_type}/{model_name}.keras`

## 未来规划

1. **扩展模型支持**：实现LSTM、Transformer和随机森林模型
2. **模型选择功能**：通过命令行参数选择不同的模型方法
3. **模型评估**：添加模型间比较功能
4. **超参数优化**：实现自动超参数调优
5. **部署支持**：添加模型部署和服务化功能

## 贡献

欢迎贡献新的模型方法或改进现有实现。请按照以下步骤：

1. 在 `models/` 目录下为新模型创建相应的子目录
2. 实现模型构建和训练逻辑
3. 更新 `main.py` 以支持新模型
4. 更新本README.md文件

## 许可证

本项目采用MIT许可证。

## 性能说明
训练完成后，模型会显示详细的性能指标，包括MSE、MAE、RMSE和R²得分。这些指标反映了模型预测的准确性和可靠性。

通过UV光谱数据预测COD值，模型能够捕捉到光谱与COD之间的相关性，为水质监测提供了一种快速、无损的分析方法。